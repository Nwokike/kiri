{% load static %}
{% load core_tags %}

<div id="comments-section" class="mt-12 border-t border-[#e0e0e0] pt-8 dark:border-[#393939]">
    <h3 class="text-xl font-semibold mb-6 text-[#161616] dark:text-white">Discussion</h3>

    <!-- New Comment Form -->
    {% if user.is_authenticated %}
    <div class="mb-8 flex gap-4">
        <div class="shrink-0">
            {% if user.github_avatar_url %}
            <img src="{{ user.github_avatar_url }}" class="w-10 h-10 border border-[#e0e0e0] dark:border-[#393939]">
            {% else %}
            <div class="w-10 h-10 bg-[#0f62fe] text-white flex items-center justify-center font-bold text-xs">
                {{ user.username|slice:":2"|upper }}</div>
            {% endif %}
        </div>
        <form hx-post="{% url 'core:add_comment' object|get_content_type_id object.id %}" hx-target="#comments-list"
            hx-swap="beforeend" hx-on::after-request="this.reset()" class="flex-1">
            {% csrf_token %}
            {{ comment_form.content }}
            <div class="mt-2 flex justify-end">
                <button type="submit"
                    class="px-4 py-2 bg-[#0f62fe] text-white text-xs font-medium hover:bg-[#0353e9] transition-colors">Post
                    Comment</button>
            </div>
        </form>
    </div>
    {% else %}
    <div class="mb-8 p-4 bg-[#f4f4f4] text-center dark:bg-[#393939]">
        <p class="text-[#525252] dark:text-[#a8a8a8] text-sm">
            <a href="{% url 'account_login' %}?next={{ request.path }}"
                class="font-bold underline hover:text-[#0f62fe]">Log in</a> to join the discussion.
        </p>
    </div>
    {% endif %}

    <!-- Comments List -->
    <div id="comments-list" class="space-y-6">
        {% for comment in comments %}
        {% include "core/partials/comment_item.html" with comment=comment %}
        {% empty %}
        <p class="text-[#a8a8a8] text-sm italic text-center" id="no-comments-msg">No comments yet. Be the first to start
            the conversation.</p>
        {% endfor %}
    </div>
</div>