{% extends "base.html" %}
{% load static %}

{% block title %}Kiri - The Research OS{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-6 py-8">

    <!-- Hero Section -->
    <section class="mb-12">
        <div
            class="relative overflow-hidden rounded-2xl bg-gradient-to-br from-[#0D7C3D] via-[#0A5C2C] to-[#084422] p-8 md:p-12">
            <div class="relative z-10">
                <h1 class="text-3xl md:text-4xl font-bold text-white mb-4">
                    The Research OS
                </h1>
                <p class="text-lg text-white/80 max-w-xl mb-6">
                    Discover, share, and run research projects instantly. From papers to working code in one click.
                </p>

                <!-- Dynamic Stats Bar -->
                <div class="flex flex-wrap gap-6 mb-6 text-white/90">
                    <div class="flex items-center gap-2">
                        <i class="fas fa-rocket"></i>
                        <span class="font-semibold">{{ stats.total_projects }}</span> Projects
                    </div>
                    <div class="flex items-center gap-2">
                        <i class="fas fa-book"></i>
                        <span class="font-semibold">{{ stats.total_publications }}</span> Publications
                    </div>
                    <div class="flex items-center gap-2">
                        <i class="fas fa-users"></i>
                        <span class="font-semibold">{{ stats.total_researchers }}</span> Researchers
                    </div>
                </div>

                <div class="flex flex-wrap gap-3">
                    <a href="{% url 'projects:list' %}"
                        class="inline-flex items-center gap-2 px-6 py-3 bg-white text-[#0D7C3D] font-semibold rounded-lg hover:bg-[#F8F9FA] transition-colors">
                        <i class="fas fa-rocket"></i>
                        Explore Projects
                    </a>
                    <a href="{% url 'publications:list' %}"
                        class="inline-flex items-center gap-2 px-6 py-3 bg-white/10 text-white font-semibold rounded-lg hover:bg-white/20 transition-colors border border-white/20">
                        <i class="fas fa-book"></i>
                        Browse Library
                    </a>
                </div>
            </div>
            <!-- Decorative elements -->
            <div class="absolute top-0 right-0 w-64 h-64 bg-[#C4992E]/20 rounded-full blur-3xl"></div>
            <div class="absolute bottom-0 left-1/2 w-48 h-48 bg-white/10 rounded-full blur-2xl"></div>
        </div>
    </section>

    <!-- Main Content Grid -->
    <div class="grid lg:grid-cols-3 gap-8">
        <!-- Left: Featured Content -->
        <div class="lg:col-span-2 space-y-8">

            <!-- Featured Projects -->
            {% if featured_projects %}
            <section>
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-xl font-semibold text-[#212529] dark:text-white flex items-center gap-2">
                        <i class="fas fa-fire text-[#C4992E]"></i>
                        Featured Projects
                    </h2>
                    <a href="{% url 'projects:list' %}" class="text-sm text-[#0D7C3D] hover:underline font-medium">
                        View All <i class="fas fa-arrow-right ml-1"></i>
                    </a>
                </div>
                <div class="grid md:grid-cols-2 gap-4">
                    {% for project in featured_projects %}
                    <a href="{% url 'projects:detail' project.slug %}"
                        class="group block p-5 bg-white rounded-xl border border-[#DEE2E6] hover:border-[#0D7C3D] hover:shadow-lg transition-all dark:bg-[#1E1E1E] dark:border-[#3D3D3D] dark:hover:border-[#0D7C3D]">
                        <div class="flex items-start justify-between mb-3">
                            <span
                                class="px-2 py-1 text-[10px] font-semibold bg-[#E8F5ED] text-[#0D7C3D] rounded uppercase">
                                {{ project.language|default:"Project" }}
                            </span>
                            {% if project.is_hot %}
                            <span class="flex items-center gap-1 text-[10px] font-semibold text-[#C4992E]">
                                <i class="fas fa-fire"></i> HOT
                            </span>
                            {% endif %}
                        </div>
                        <h3
                            class="text-[#212529] dark:text-white font-semibold mb-2 group-hover:text-[#0D7C3D] transition-colors">
                            {{ project.name }}
                        </h3>
                        <p class="text-sm text-[#6C757D] dark:text-[#A1A1AA] line-clamp-2 mb-3">
                            {{ project.description|truncatewords:20 }}
                        </p>
                        <div class="flex items-center gap-4 text-xs text-[#6C757D] dark:text-[#A1A1AA]">
                            <span class="flex items-center gap-1">
                                <i class="fas fa-star text-[#C4992E]"></i>
                                {{ project.stars_count }}
                            </span>
                            <span class="flex items-center gap-1">
                                <i class="fas fa-code-branch"></i>
                                {{ project.forks_count }}
                            </span>
                            <span class="flex items-center gap-1">
                                <i class="fas fa-eye"></i>
                                {{ project.view_count }}
                            </span>
                        </div>
                    </a>
                    {% endfor %}
                </div>
            </section>
            {% endif %}

            <!-- Latest Publications -->
            {% if latest_publications %}
            <section>
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-xl font-semibold text-[#212529] dark:text-white flex items-center gap-2">
                        <i class="fas fa-newspaper text-[#0D7C3D]"></i>
                        Latest Publications
                    </h2>
                    <a href="{% url 'publications:list' %}" class="text-sm text-[#0D7C3D] hover:underline font-medium">
                        View All <i class="fas fa-arrow-right ml-1"></i>
                    </a>
                </div>
                <div class="space-y-4">
                    {% for pub in latest_publications %}
                    <a href="{% url 'publications:detail' pub.slug %}"
                        class="group flex gap-5 p-5 bg-white rounded-xl border border-[#DEE2E6] hover:border-[#0D7C3D] hover:shadow-lg transition-all dark:bg-[#1E1E1E] dark:border-[#3D3D3D] dark:hover:border-[#0D7C3D]">
                        <div
                            class="w-12 h-12 shrink-0 bg-gradient-to-br from-[#0D7C3D] to-[#0A5C2C] rounded-lg flex items-center justify-center text-white">
                            <i class="fas fa-file-alt"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <h3
                                class="text-[#212529] dark:text-white font-semibold mb-1 group-hover:text-[#0D7C3D] transition-colors truncate">
                                {{ pub.title }}
                            </h3>
                            <p class="text-sm text-[#6C757D] dark:text-[#A1A1AA]">
                                {{ pub.author.username }} Â· {{ pub.created_at|date:"M d, Y" }}
                            </p>
                        </div>
                        <i
                            class="fas fa-chevron-right text-[#DEE2E6] group-hover:text-[#0D7C3D] self-center transition-colors"></i>
                    </a>
                    {% endfor %}
                </div>
            </section>
            {% endif %}

            <!-- Empty State -->
            {% if not featured_projects and not latest_publications %}
            <section class="text-center py-16">
                <div
                    class="w-20 h-20 mx-auto mb-6 bg-[#F8F9FA] dark:bg-[#2D2D2D] rounded-full flex items-center justify-center">
                    <i class="fas fa-seedling text-3xl text-[#0D7C3D]"></i>
                </div>
                <h3 class="text-xl font-semibold text-[#212529] dark:text-white mb-2">Building something new</h3>
                <p class="text-[#6C757D] dark:text-[#A1A1AA] mb-6 max-w-md mx-auto">
                    Be among the first to share your research and projects.
                </p>
                {% if not user.is_authenticated %}
                <a href="{% url 'account_login' %}"
                    class="inline-flex items-center gap-2 px-6 py-3 bg-[#0D7C3D] text-white font-semibold rounded-lg hover:bg-[#0A5C2C] transition-colors">
                    <i class="fas fa-user-plus"></i>
                    Join Now
                </a>
                {% endif %}
            </section>
            {% endif %}
        </div>

        <!-- Right: Sidebar -->
        <div class="space-y-6">
            <!-- Join CTA (for guests) -->
            {% if not user.is_authenticated %}
            <div class="p-6 bg-gradient-to-br from-[#0D7C3D] to-[#0A5C2C] rounded-xl text-white">
                <h3 class="text-lg font-semibold mb-2">Join Kiri</h3>
                <p class="text-sm text-white/80 mb-4">
                    Connect with GitHub, GitLab, Bitbucket, or Hugging Face.
                </p>
                <a href="{% url 'account_login' %}"
                    class="flex items-center justify-center gap-2 w-full py-3 bg-white text-[#0D7C3D] font-semibold rounded-lg hover:bg-[#F8F9FA] transition-colors">
                    <i class="fas fa-arrow-right"></i>
                    Get Started
                </a>
            </div>
            {% endif %}

            <!-- Trending Projects -->
            {% if trending_projects %}
            <div class="p-6 bg-white rounded-xl border border-[#DEE2E6] dark:bg-[#1E1E1E] dark:border-[#3D3D3D]">
                <h3 class="text-lg font-semibold text-[#212529] dark:text-white mb-4 flex items-center gap-2">
                    <i class="fas fa-chart-line text-[#C4992E]"></i>
                    Trending
                </h3>
                <div class="space-y-3">
                    {% for project in trending_projects %}
                    <a href="{% url 'projects:detail' project.slug %}" class="flex items-center gap-3 group">
                        <span class="text-lg font-bold text-[#DEE2E6] dark:text-[#3D3D3D]">{{ forloop.counter }}</span>
                        <div class="flex-1 min-w-0">
                            <p
                                class="text-sm font-medium text-[#212529] dark:text-white truncate group-hover:text-[#0D7C3D] transition-colors">
                                {{ project.name }}
                            </p>
                            <p class="text-xs text-[#6C757D] dark:text-[#A1A1AA]">
                                {{ project.view_count }} views
                            </p>
                        </div>
                    </a>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <!-- Categories -->
            {% if categories %}
            <div class="p-6 bg-white rounded-xl border border-[#DEE2E6] dark:bg-[#1E1E1E] dark:border-[#3D3D3D]">
                <h3 class="text-lg font-semibold text-[#212529] dark:text-white mb-4 flex items-center gap-2">
                    <i class="fas fa-tags text-[#0D7C3D]"></i>
                    Categories
                </h3>
                <div class="flex flex-wrap gap-2">
                    {% for cat in categories %}
                    <a href="{% url 'projects:list' %}?category={{ cat.category }}"
                        class="px-3 py-1.5 text-sm bg-[#F8F9FA] dark:bg-[#2D2D2D] text-[#495057] dark:text-[#A1A1AA] rounded-lg hover:bg-[#E8F5ED] hover:text-[#0D7C3D] transition-colors">
                        {{ cat.category|default:"Other" }}
                        <span class="text-xs text-[#6C757D]">({{ cat.count }})</span>
                    </a>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <!-- Platform Stats -->
            <div class="p-6 bg-white rounded-xl border border-[#DEE2E6] dark:bg-[#1E1E1E] dark:border-[#3D3D3D]">
                <h3 class="text-lg font-semibold text-[#212529] dark:text-white mb-4 flex items-center gap-2">
                    <i class="fas fa-chart-bar text-[#6C757D]"></i>
                    Platform Stats
                </h3>
                <div class="space-y-3">
                    <div class="flex items-center justify-between">
                        <span class="text-sm text-[#6C757D] dark:text-[#A1A1AA]">Projects</span>
                        <span class="text-sm font-semibold text-[#212529] dark:text-white">{{ stats.total_projects
                            }}</span>
                    </div>
                    <div class="flex items-center justify-between">
                        <span class="text-sm text-[#6C757D] dark:text-[#A1A1AA]">Publications</span>
                        <span class="text-sm font-semibold text-[#212529] dark:text-white">{{ stats.total_publications
                            }}</span>
                    </div>
                    <div class="flex items-center justify-between">
                        <span class="text-sm text-[#6C757D] dark:text-[#A1A1AA]">Researchers</span>
                        <span class="text-sm font-semibold text-[#212529] dark:text-white">{{ stats.total_researchers
                            }}</span>
                    </div>
                </div>
            </div>

            <!-- Learn More -->
            <div class="p-6 bg-white rounded-xl border border-[#DEE2E6] dark:bg-[#1E1E1E] dark:border-[#3D3D3D]">
                <h3 class="text-lg font-semibold text-[#212529] dark:text-white mb-3 flex items-center gap-2">
                    <i class="fas fa-info-circle text-[#C4992E]"></i>
                    About
                </h3>
                <p class="text-sm text-[#6C757D] dark:text-[#A1A1AA] mb-4">
                    Kiri is a platform for discovering, sharing, and running research projects.
                </p>
                <a href="{% url 'core:about' %}" class="text-sm text-[#0D7C3D] hover:underline font-medium">
                    Learn More <i class="fas fa-arrow-right ml-1"></i>
                </a>
            </div>
        </div>
    </div>
</div>

<!-- Mobile Spacer -->
<div class="h-20 md:hidden"></div>
{% endblock %}