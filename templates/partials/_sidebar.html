{% load static %}

<!-- IBM Seismic Style Sidebar (Collapsed by default, expands on hover) -->
<aside id="sidebar"
    class="hidden md:flex flex-col w-[64px] hover:w-64 h-screen sticky top-0 bg-white border-r border-border shrink-0 z-40 transition-all duration-200 dark:bg-dark-bg dark:border-dark-border overflow-hidden group/sidebar"
    data-expanded="false">

    <!-- Sidebar Header -->
    <div class="h-14 flex items-center border-b border-border dark:border-dark-border px-4 gap-3 min-w-max">
        <!-- Logo -->
        <a href="/" class="flex items-center gap-3 shrink-0">
            <img src="{% static 'images/logos/logo.png' %}" alt="Kiri" class="w-7 h-7 shrink-0">
            <span
                class="font-semibold text-text-primary dark:text-dark-text opacity-0 group-hover/sidebar:opacity-100 transition-opacity whitespace-nowrap">KIRI</span>
        </a>
    </div>

    <!-- Navigation Items -->
    <nav id="sidebar-nav" class="flex-1 overflow-y-auto py-2">
        <!-- Home -->
        <a href="{% url 'core:home' %}"
            class="flex items-center h-12 px-4 gap-3 text-text-secondary hover:bg-bg-secondary hover:text-text-primary dark:text-dark-secondary dark:hover:bg-dark-surface dark:hover:text-white transition-colors
            {% if request.path == '/' %}bg-[rgba(31,87,164,0.1)] text-[#1F57A4] dark:bg-[rgba(31,87,164,0.1)] dark:text-[#1F57A4]{% endif %}">
            <i class="fas fa-home w-6 text-center text-lg shrink-0"></i>
            <span
                class="text-sm font-medium whitespace-nowrap opacity-0 group-hover/sidebar:opacity-100 transition-opacity">Home</span>
        </a>

        <!-- Publications -->
        <a href="{% url 'publications:list' %}"
            class="flex items-center h-12 px-4 gap-3 text-text-secondary hover:bg-bg-secondary hover:text-text-primary dark:text-dark-secondary dark:hover:bg-dark-surface dark:hover:text-white transition-colors
            {% if 'publications' in request.path or 'library' in request.path %}bg-[rgba(31,87,164,0.1)] text-[#1F57A4] dark:bg-[rgba(31,87,164,0.1)] dark:text-[#1F57A4]{% endif %}">
            <i class="fas fa-newspaper w-6 text-center text-lg shrink-0"></i>
            <span
                class="text-sm font-medium whitespace-nowrap opacity-0 group-hover/sidebar:opacity-100 transition-opacity">Publications</span>
        </a>

        <!-- Projects -->
        <a href="{% url 'projects:list' %}"
            class="flex items-center h-12 px-4 gap-3 text-text-secondary hover:bg-bg-secondary hover:text-text-primary dark:text-dark-secondary dark:hover:bg-dark-surface dark:hover:text-white transition-colors
            {% if 'projects' in request.path or 'colosseum' in request.path %}bg-[rgba(31,87,164,0.1)] text-[#1F57A4] dark:bg-[rgba(31,87,164,0.1)] dark:text-[#1F57A4]{% endif %}">
            <i class="fas fa-chart-bar w-6 text-center text-lg shrink-0"></i>
            <span
                class="text-sm font-medium whitespace-nowrap opacity-0 group-hover/sidebar:opacity-100 transition-opacity">Projects</span>
        </a>

        <!-- Divider -->
        <div class="my-3 mx-4 border-t border-border dark:border-dark-border"></div>

        <!-- Trending Section Label -->
        <div class="px-4 py-2 opacity-0 group-hover/sidebar:opacity-100 transition-opacity">
            <span
                class="text-xs font-semibold text-text-tertiary dark:text-dark-secondary uppercase tracking-wider">Trending</span>
        </div>
    </nav>

    <!-- User Section (Bottom) -->
    <div class="border-t border-border dark:border-dark-border p-2 min-w-max">
        {% if user.is_authenticated %}
        <div class="flex items-center h-12 px-2 gap-3">
            {% if user.github_avatar_url %}
            <img src="{{ user.github_avatar_url }}" alt="Avatar"
                class="w-8 h-8 rounded-full border border-border dark:border-dark-border shrink-0">
            {% else %}
            <div
                class="w-8 h-8 rounded-full bg-[#1F57A4] text-white flex items-center justify-center font-semibold text-xs shrink-0">
                {{ user.username|slice:":2"|upper }}
            </div>
            {% endif %}
            <div class="flex-1 min-w-0 opacity-0 group-hover/sidebar:opacity-100 transition-opacity">
                <div class="text-sm font-medium text-text-primary dark:text-dark-text truncate">{{ user.username }}
                </div>
                <div class="text-xs text-text-tertiary dark:text-dark-secondary truncate">{{
                    user.get_role_display|default:"Member" }}</div>
            </div>
        </div>
        {% else %}
        {% load socialaccount %}
        <a href="{% provider_login_url 'github' process='login' %}"
            class="flex items-center justify-center h-10 gap-2 bg-[#1F57A4] text-white text-sm font-medium hover:bg-[#1846a1] transition-colors px-3">
            <i class="fab fa-github shrink-0"></i>
            <span class="whitespace-nowrap opacity-0 group-hover/sidebar:opacity-100 transition-opacity">Join
                Kiri</span>
        </a>
        {% endif %}

        <!-- Dark Mode Toggle -->
        <button id="theme-toggle-sidebar"
            class="mt-2 w-full flex items-center justify-center h-10 gap-2 text-xs text-text-tertiary hover:text-text-primary dark:text-dark-secondary dark:hover:text-white transition-colors">
            <i class="fas fa-moon shrink-0"></i>
            <span class="whitespace-nowrap opacity-0 group-hover/sidebar:opacity-100 transition-opacity">Dark
                Mode</span>
        </button>
    </div>
</aside>