{% extends "base.html" %}

{% block title %}Projects | Kiri{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-6 py-8">
    <!-- Page Header -->
    <header class="mb-8">
        <div class="flex flex-col md:flex-row md:items-center justify-between gap-4">
            <div>
                <h1 class="text-2xl font-bold text-[#212529] dark:text-white">Projects</h1>
                <p class="text-[#6C757D] dark:text-[#A1A1AA] mt-1">
                    Open-source projects and tools from the Kiri community.
                </p>
            </div>

            <div class="flex items-center gap-3">
                {% if user.is_authenticated %}
                <button hx-get="{% url 'projects:submit' %}" hx-target="#submission-area" hx-swap="innerHTML"
                    class="px-5 py-2.5 bg-[#0D7C3D] text-white text-sm font-semibold rounded-lg hover:bg-[#0A5C2C] transition-colors">
                    <i class="fas fa-plus mr-2"></i>Submit Project
                </button>
                {% else %}
                <a href="{% url 'account_login' %}?next={{ request.path }}"
                    class="px-5 py-2.5 border border-[#0D7C3D] text-[#0D7C3D] text-sm font-semibold rounded-lg hover:bg-[#E8F5ED] transition-colors">
                    Login to Submit
                </a>
                {% endif %}
            </div>
        </div>

        <!-- Filters -->
        <div class="flex flex-wrap items-center gap-2 mt-6">
            <a href="{% url 'projects:list' %}"
                class="px-4 py-2 text-sm font-medium rounded-lg transition-colors
                {% if not request.GET.category and not request.GET.hot %}bg-[#0D7C3D] text-white{% else %}bg-white text-[#495057] border border-[#DEE2E6] hover:bg-[#F8F9FA] dark:bg-[#1E1E1E] dark:border-[#3D3D3D] dark:text-[#A1A1AA]{% endif %}">
                All
            </a>
            <a href="?category=ai_nlp"
                class="px-4 py-2 text-sm font-medium rounded-lg transition-colors
                {% if request.GET.category == 'ai_nlp' %}bg-[#0D7C3D] text-white{% else %}bg-white text-[#495057] border border-[#DEE2E6] hover:bg-[#F8F9FA] dark:bg-[#1E1E1E] dark:border-[#3D3D3D] dark:text-[#A1A1AA]{% endif %}">
                AI / NLP
            </a>
            <a href="?category=ai_vision"
                class="px-4 py-2 text-sm font-medium rounded-lg transition-colors
                {% if request.GET.category == 'ai_vision' %}bg-[#0D7C3D] text-white{% else %}bg-white text-[#495057] border border-[#DEE2E6] hover:bg-[#F8F9FA] dark:bg-[#1E1E1E] dark:border-[#3D3D3D] dark:text-[#A1A1AA]{% endif %}">
                Computer Vision
            </a>
            <a href="?hot=true"
                class="px-4 py-2 text-sm font-medium rounded-lg transition-colors
                {% if request.GET.hot %}bg-[#C4992E] text-white{% else %}bg-white text-[#495057] border border-[#DEE2E6] hover:bg-[#F8F9FA] dark:bg-[#1E1E1E] dark:border-[#3D3D3D] dark:text-[#A1A1AA]{% endif %}">
                <i class="fas fa-fire mr-1"></i> Trending
            </a>

            <div class="ml-auto">
                <select onchange="window.location.href=this.value"
                    class="px-4 py-2 bg-white border border-[#DEE2E6] rounded-lg text-sm text-[#495057] focus:outline-none focus:border-[#0D7C3D] dark:bg-[#1E1E1E] dark:border-[#3D3D3D] dark:text-[#A1A1AA]">
                    <option value="?sort=-created_at">Newest</option>
                    <option value="?sort=-stars_count">Most Stars</option>
                </select>
            </div>
        </div>
    </header>

    <!-- Submission Area -->
    <div id="submission-area" class="empty:hidden mb-6"></div>

    <!-- Projects Grid -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {% for project in projects %}
        <article
            class="bg-white rounded-xl border border-[#DEE2E6] hover:shadow-lg hover:border-[#0D7C3D] transition-all dark:bg-[#1E1E1E] dark:border-[#3D3D3D] dark:hover:border-[#0D7C3D] group">
            <div class="p-5">
                <div class="flex items-start justify-between mb-3">
                    <span class="px-2 py-1 text-[10px] font-semibold bg-[#E8F5ED] text-[#0D7C3D] rounded uppercase">
                        {{ project.language|default:"Project" }}
                    </span>
                    {% if project.is_hot %}
                    <span class="flex items-center gap-1 text-[10px] font-semibold text-[#C4992E]">
                        <i class="fas fa-fire"></i> HOT
                    </span>
                    {% endif %}
                </div>

                <h3 class="text-[#0D7C3D] font-semibold mb-2 group-hover:underline">
                    <a href="{% url 'projects:detail' project.slug %}">{{ project.name }}</a>
                </h3>

                <p class="text-sm text-[#6C757D] dark:text-[#A1A1AA] line-clamp-2 mb-4">
                    {{ project.description }}
                </p>

                <div class="flex items-center justify-between text-xs text-[#6C757D] dark:text-[#A1A1AA]">
                    <div class="flex items-center gap-3">
                        <span class="flex items-center gap-1">
                            <i class="fas fa-star text-[#C4992E]"></i>
                            {{ project.stars_count }}
                        </span>
                        <span class="flex items-center gap-1">
                            <i class="fas fa-code-branch"></i>
                            {{ project.forks_count }}
                        </span>
                    </div>
                    <a href="{{ project.github_repo_url }}" target="_blank"
                        class="hover:text-[#0D7C3D] transition-colors">
                        <i class="fab fa-github text-lg"></i>
                    </a>
                </div>
            </div>
        </article>
        {% empty %}
        <div class="col-span-full py-16 text-center">
            <div
                class="w-20 h-20 mx-auto mb-6 bg-[#F8F9FA] dark:bg-[#2D2D2D] rounded-full flex items-center justify-center">
                <i class="fas fa-folder-open text-3xl text-[#DEE2E6] dark:text-[#3D3D3D]"></i>
            </div>
            <h3 class="text-lg font-semibold text-[#212529] dark:text-white mb-2">No projects yet</h3>
            <p class="text-[#6C757D] dark:text-[#A1A1AA]">Be the first to share a project!</p>
        </div>
        {% endfor %}
    </div>

    <!-- Pagination -->
    {% if is_paginated %}
    <div class="flex items-center justify-between mt-8 pt-6 border-t border-[#DEE2E6] dark:border-[#3D3D3D]">
        <span class="text-sm text-[#6C757D] dark:text-[#A1A1AA]">
            Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}
        </span>
        <div class="flex items-center gap-2">
            {% if page_obj.has_previous %}
            <a href="?page={{ page_obj.previous_page_number }}"
                class="px-4 py-2 text-sm text-[#0D7C3D] hover:bg-[#E8F5ED] rounded-lg transition-colors">
                <i class="fas fa-chevron-left mr-1"></i> Previous
            </a>
            {% endif %}
            {% if page_obj.has_next %}
            <a href="?page={{ page_obj.next_page_number }}"
                class="px-4 py-2 text-sm text-[#0D7C3D] hover:bg-[#E8F5ED] rounded-lg transition-colors">
                Next <i class="fas fa-chevron-right ml-1"></i>
            </a>
            {% endif %}
        </div>
    </div>
    {% endif %}
</div>

<div class="h-20 md:hidden"></div>
{% endblock %}