{% extends "base.html" %}

{% block title %}Publications | Kiri Research Labs{% endblock %}

{% block content %}
<div class="space-y-8">
    <!-- Header -->
    <header
        class="flex flex-col md:flex-row md:items-center justify-between gap-6 pb-8 border-b border-border dark:border-dark-border">
        <div>
            <h1 class="text-3xl font-bold font-display text-text-primary dark:text-white mb-2">The Library</h1>
            <p class="text-text-secondary dark:text-dark-secondary">
                Curated research papers and interactive technical demonstrations.
            </p>
        </div>

        <!-- Search -->
        <form method="get" action="" class="relative">
            <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-text-tertiary"></i>
            <input type="text" name="q" placeholder="Search publications..." value="{{ request.GET.q|default:'' }}"
                class="w-full md:w-72 pl-10 pr-4 py-2 bg-bg-secondary border border-border rounded-lg text-sm focus:ring-1 focus:ring-brand-green focus:border-brand-green dark:bg-dark-surface dark:border-dark-border dark:text-white placeholder-text-tertiary">
        </form>
    </header>

    <!-- Content Grid -->
    <div class="grid gap-8">
        {% for publication in publications %}
        <article
            class="group flex flex-col md:flex-row gap-6 md:items-start p-6 rounded-xl border border-transparent hover:border-border hover:bg-bg-secondary dark:hover:bg-dark-surface/50 dark:hover:border-dark-border transition-all">
            <!-- Meta (Left on desktop) -->
            <div class="md:w-48 shrink-0 flex flex-col gap-2 text-sm text-text-tertiary dark:text-dark-secondary">
                <span class="font-mono text-brand-green">{{ publication.created_at|date:"F j, Y" }}</span>
                <div class="flex items-center gap-2">
                    <i class="fas fa-user-circle"></i>
                    <span>{{ publication.author.username }}</span>
                </div>
                {% if publication.executable_script %}
                <div class="flex items-center gap-2 text-brand-gold mt-1">
                    <i class="fab fa-python"></i>
                    <span>Interactive</span>
                </div>
                {% endif %}
            </div>

            <!-- Main Content -->
            <div class="flex-1 min-w-0">
                <h2
                    class="text-xl font-bold font-display text-text-primary dark:text-white mb-2 group-hover:text-brand-green transition-colors">
                    <a href="{% url 'publications:detail' publication.slug %}" class="focus:outline-none">
                        {{ publication.title }}
                    </a>
                </h2>
                <p class="text-text-secondary dark:text-dark-secondary mb-4 line-clamp-2">
                    {{ publication.abstract }}
                </p>
                <div class="flex items-center gap-4 text-xs font-medium">
                    <a href="{% url 'publications:detail' publication.slug %}" class="btn-secondary py-1.5 px-3">
                        Read Paper
                    </a>
                    {% if publication.executable_script %}
                    <a href="{% url 'publications:detail' publication.slug %}#run-code-btn"
                        class="text-brand-gold hover:underline">
                        <i class="fas fa-play mr-1"></i> Try Demo
                    </a>
                    {% endif %}
                </div>
            </div>
        </article>

        {% empty %}
        <div class="py-12 text-center text-text-tertiary">
            <i class="fas fa-book-open text-4xl mb-4 opacity-50"></i>
            <p>No publications found matching your criteria.</p>
        </div>
        {% endfor %}
    </div>

    <!-- Pagination -->
    {% if is_paginated %}
    <div class="flex justify-center pt-8">
        <div class="flex items-center gap-2">
            {% if page_obj.has_previous %}
            <a href="?page={{ page_obj.previous_page_number }}"
                class="px-4 py-2 rounded-lg border border-gray-200 text-gray-600 hover:text-gray-900 hover:border-gray-400 text-sm transition-colors">
                Previous
            </a>
            {% endif %}
            <span class="px-4 py-2 text-sm text-gray-400">
                Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}
            </span>
            {% if page_obj.has_next %}
            <a href="?page={{ page_obj.next_page_number }}"
                class="px-4 py-2 rounded-lg border border-gray-200 text-gray-600 hover:text-gray-900 hover:border-gray-400 text-sm transition-colors">
                Next
            </a>
            {% endif %}
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}