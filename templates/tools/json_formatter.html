{% extends "base.html" %}

{% block title %}JSON Formatter | Kiri Tools{% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto px-4 py-8" x-data="jsonFormatter()">
    <nav class="mb-6 text-sm">
        <a href="{% url 'tools:index' %}" class="text-blue-600 hover:underline"><i class="fas fa-arrow-left mr-1"></i>
            Tools</a>
        <span class="text-gray-400 mx-2">/</span>
        <span class="text-gray-600 dark:text-gray-300">JSON Formatter</span>
    </nav>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 h-[calc(100vh-200px)]">
        <!-- Input -->
        <div class="flex flex-col">
            <div class="mb-2 flex justify-between items-center">
                <label class="text-sm font-medium text-gray-700 dark:text-gray-300">Input JSON</label>
                <div class="space-x-2">
                    <button @click="sample()" class="text-xs text-blue-600 hover:text-blue-800">Sample</button>
                    <button @click="clear()" class="text-xs text-red-600 hover:text-red-800">Clear</button>
                </div>
            </div>
            <textarea x-model="input"
                class="flex-1 w-full p-4 font-mono text-sm border border-gray-300 dark:border-[#444] rounded-lg focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-[#1E1E1E] text-gray-900 dark:text-white resize-none"
                placeholder="Paste JSON here..."></textarea>
        </div>

        <!-- Output -->
        <div class="flex flex-col">
            <div class="mb-2 flex justify-between items-center">
                <label class="text-sm font-medium text-gray-700 dark:text-gray-300">Formatted Output</label>
                <div class="space-x-2">
                    <button @click="copy()" class="text-xs text-green-600 hover:text-green-800"
                        x-text="copied ? 'Copied!' : 'Copy'"></button>
                </div>
            </div>
            <div class="relative flex-1">
                <textarea readonly x-model="output" :class="{'border-red-500': error}"
                    class="w-full h-full p-4 font-mono text-sm border border-gray-300 dark:border-[#444] rounded-lg bg-gray-50 dark:bg-[#252526] text-gray-900 dark:text-gray-300 resize-none"></textarea>

                <div x-show="error"
                    class="absolute bottom-4 left-4 right-4 bg-red-100 text-red-700 px-4 py-2 rounded text-sm border border-red-200">
                    <i class="fas fa-exclamation-circle mr-2"></i> <span x-text="error"></span>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    function jsonFormatter() {
        return {
            input: '',
            error: '',
            copied: false,

            get output() {
                this.error = '';
                if (!this.input.trim()) return '';
                try {
                    const parsed = JSON.parse(this.input);
                    return JSON.stringify(parsed, null, 4);
                } catch (e) {
                    this.error = e.message;
                    return this.input;
                }
            },

            sample() {
                this.input = '{"name": "Kiri", "type": "Platform", "features": ["AI", "Tools"], "active": true}';
            },

            clear() {
                this.input = '';
            },

            copy() {
                if (!this.output || this.error) return;
                navigator.clipboard.writeText(this.output);
                this.copied = true;
                setTimeout(() => this.copied = false, 2000);
            }
        }
    }
</script>
{% endblock %}